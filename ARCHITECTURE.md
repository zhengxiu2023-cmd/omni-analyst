ðŸ—ï¸ ç³»ç»Ÿæž¶æž„è®¾è®¡ (Architecture)

1. ç›®å½•æ ‘ç»“æž„ (Directory Tree)

ä¸ºäº†å½»åº•æ¶ˆç­åŽŸæœ‰çš„â€œGod Classâ€ï¼Œç³»ç»Ÿå°†é‡‡ç”¨é«˜å†…èšã€ä½Žè€¦åˆçš„æ¨¡å—åŒ–è®¾è®¡ã€‚æœ¬æ¬¡å¼•å…¥äº†æ ‡å‡†é…ç½®å±‚ä¸Žæ•°æ®æ¨¡åž‹å±‚ï¼š

omni_analyst/
â”œâ”€â”€ main.py                    # ðŸŸ¢ ç»ˆç«¯ä¸»å…¥å£ (UIäº¤äº’å±‚)
â”œâ”€â”€ config.py                  # âš™ï¸ å…¨å±€é…ç½®ä¸­å¿ƒ (æ­£åˆ™è¯åº“/APIåœ°å€/Headers/æ¨¡åž‹å‚æ•°)
â”œâ”€â”€ core/                      # ðŸ”´ æ ¸å¿ƒä¸šåŠ¡ä¸Žå¼•æ“Žå±‚
â”‚   â”œâ”€â”€ models.py              # ðŸ§± æ ¸å¿ƒæ•°æ®ç»“æž„ (Dataclasses: StockInfoæ–°å¢žpe_ttm/roe/gross_margin, CompetitorFinancials)
â”‚   â”œâ”€â”€ network_engine.py      # å†›å·¥çº§è¯·æ±‚é‡è¯•(TenacityæŒ‡æ•°é€€é¿/UAè½®æ¢/éšæœºæŠ–åŠ¨)ä¸Žæµå¼ä¸‹è½½
â”‚   â”œâ”€â”€ llm_engine.py          # Ollama æœ¬åœ°æ¨¡åž‹äº¤äº’å°è£…
â”‚   â”œâ”€â”€ db_client.py           # (å¯é€‰) MongoDB æŒä¹…åŒ–å®¢æˆ·ç«¯
â”‚   â””â”€â”€ risk_auditor.py        # Phase V é£ŽæŽ§ç†”æ–­é€»è¾‘ (æ­»äº¡æ¢æ‰‹/ä¼°å€¼æµ‹ç®—)
â”œâ”€â”€ fetchers/                  # ðŸŸ¡ æ•°æ®é‡‡é›†å±‚
â”‚   â”œâ”€â”€ akshare_client.py      # é¾™è™Žæ¦œ/æ¿å—/è¡Œæƒ…/åŸºæœ¬é¢èŽ·å–
â”‚   â”œâ”€â”€ cninfo_spider.py       # å·¨æ½®èµ„è®¯ PDF æ£€ç´¢ä¸Žå®šä½
â”‚   â”œâ”€â”€ cctv_news.py           # å®è§‚æ–°é—»é‡‡é›†
â”‚   â”œâ”€â”€ news_flow_fetcher.py   # å…¨ç½‘ç¤¾äº¤æµé‡ç›‘æŽ§ä¸Žçƒ­ç‚¹æå–
â”‚   â””â”€â”€ financial_fetcher.py   # ç«Ÿå¯¹è´¢æŠ¥çºµå‘/æ¨ªå‘æ•°æ®æå–
â”œâ”€â”€ utils/                     # ðŸ”µ å·¥å…·å±‚
â”‚   â”œâ”€â”€ pdf_extractor.py       # ä½¿ç”¨ PyMuPDF æå–æ–‡æ¡£å…³é”®æ–‡æœ¬
â”‚   â””â”€â”€ logger.py              # ç»Ÿä¸€çš„ç»ˆç«¯æ—¥å¿—è¾“å‡ºæ ¼å¼åŒ–å·¥å…·
â””â”€â”€ company_info/              # ðŸ“‚ äº§å‡ºç‰©å­˜å‚¨åŒº (åŠ¨æ€ç”Ÿæˆ)
    â””â”€â”€ {åç§°}_{ä»£ç }/
        â”œâ”€â”€ 00_å‚æ•°é¢æ¿_å‘ç»™AI.md
        â”œâ”€â”€ xxå¹´å¹´åº¦æŠ¥å‘Š.pdf
        â””â”€â”€ æŠ•èµ„è€…è°ƒç ”çºªè¦.pdf


2. æ•°æ®æµè½¬å›¾ (Data Flow)

main.py æŽ¥æ”¶ç”¨æˆ·è¾“å…¥å¹¶åˆå§‹åŒ–é…ç½®ã€‚

è°ƒç”¨ fetchers å±‚ï¼Œå°†å¤–éƒ¨è„æ•°æ®ç»Ÿä¸€å°è£…ä¸º core.models ä¸­å®šä¹‰çš„æ•°æ®ç±» (Dataclass) å¯¹è±¡ã€‚

å°†æ•°æ®å¯¹è±¡ä¼ å…¥ core.llm_engine å’Œ config.py ä¸­çš„æ­£åˆ™è¯åº“è¿›è¡Œæçº¯è¿‡æ»¤ã€‚

è°ƒç”¨ core.network_engine æŠŠè¿œç¨‹å¤§æ–‡ä»¶æµå¼å†™åˆ°æœ¬åœ° company_info/ã€‚

ä½¿ç”¨ utils.pdf_extractor è¯»å–æœ¬åœ° PDF æŠ½å– RAG å¢žé‡å†…å®¹ã€‚

è°ƒç”¨ core.risk_auditor ç»„è£…æ‰€æœ‰ä¿¡æ¯ï¼Œè¦†å†™åˆ° Markdown é¢æ¿ï¼Œå¹¶å¯é€‰è°ƒç”¨ core.db_client å…¥åº“ã€‚

3. å¼€å‘è§„èŒƒ

é…ç½®åˆ†ç¦»: æ‰€æœ‰å¤–éƒ¨ URLã€è¶…æ—¶æ—¶é—´ã€æ­£åˆ™è¯åº“å¿…é¡»å®šä¹‰åœ¨ config.py ä¸­ï¼Œä¸¥ç¦åœ¨ä¸šåŠ¡ä»£ç ä¸­ç¡¬ç¼–ç ã€‚

æ•°æ®å¥‘çº¦: å±‚ä¸Žå±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå¿…é¡»ä½¿ç”¨ core.models ä¸­å®šä¹‰çš„ dataclassï¼ŒåºŸå¼ƒéšæ„çš„å­—å…¸ä¼ é€’ã€‚

é˜²å¾¡æ€§ç¼–ç¨‹: æ‰€æœ‰å¤–éƒ¨ API è¯·æ±‚å¿…é¡»è¢« try...except åŒ…è£¹ï¼Œå¹¶æä¾› fallbackï¼ˆå…œåº•ï¼‰é»˜è®¤å€¼ã€‚

ç±»åž‹æç¤º: æ‰€æœ‰æ ¸å¿ƒå‡½æ•°å¿…é¡»ä½¿ç”¨ Python Type Hinting (å¦‚ def fetch_data(code: str) -> StockInfo:)ã€‚