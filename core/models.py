# -*- coding: utf-8 -*-
"""
ğŸ§± core/models.py â€” Omni-Analyst v7.5 æ ¸å¿ƒæ•°æ®æ¨¡å‹å¥‘çº¦ (Singularity)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
æ¶æ„è§„èŒƒï¼š
  - æ‰€æœ‰å±‚ä¸å±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå¿…é¡»ä½¿ç”¨æ­¤æ–‡ä»¶ä¸­å®šä¹‰çš„ Dataclassã€‚
  - ç¦æ­¢åœ¨å±‚é—´ä¼ é€’åŸå§‹ dict ä»£æ›¿ Dataclassã€‚
  - å­—æ®µåä¸ DATA_CONTRACTS.md ä¿æŒä¸¥æ ¼ä¸€è‡´ï¼Œä¸å¾—ç§è‡ªä¿®æ”¹ã€‚

å¯¹åº”æ–‡æ¡£ï¼šDATA_CONTRACTS.md > ç¬¬ 1 èŠ‚ "æ ¸å¿ƒæ•°æ®æ¨¡å‹å¥‘çº¦"
"""

from __future__ import annotations

from dataclasses import dataclass, field
from typing import Union


# ===========================================================================
# 1.1 StockInfo â€” åŸºç¡€è¡Œæƒ…ä¸å†å²æå€¼æ¨¡å‹
# ç”± fetchers/akshare_client.py å’Œ fetchers/eastmoney æ¥å£å¡«å……
# ===========================================================================
@dataclass
class StockInfo:
    """å•åªè‚¡ç¥¨çš„å®Œæ•´åŸºç¡€è¡Œæƒ…ä¸é£æ§å…³é”®æ•°æ®ã€‚"""

    # --- å¿…å¡«åŸºç¡€å­—æ®µï¼ˆåˆå§‹åŒ–æ—¶å¿…é¡»æä¾›ï¼‰---
    code: str                            # è‚¡ç¥¨ä»£ç ï¼Œå¦‚ "000001"ï¼ˆä¸å«å¸‚åœºå‰ç¼€ï¼‰
    name: str                            # è‚¡ç¥¨ä¸­æ–‡åç§°ï¼Œå¦‚ "å¹³å®‰é“¶è¡Œ"
    price: float                         # æœ€æ–°ä»·ï¼ˆå•ä½ï¼šå…ƒï¼‰
    turnover: float                      # æœ€æ–°æ¢æ‰‹ç‡ï¼ˆå•ä½ï¼š%ï¼‰
    pe_ttm: Union[str, float]            # æ»šåŠ¨å¸‚ç›ˆç‡ï¼›æ•°æ®ç¼ºå¤±æ—¶ä¸ºå­—ç¬¦ä¸² "N/A"
    pb: Union[str, float]                # å¸‚å‡€ç‡ï¼›æ•°æ®ç¼ºå¤±æ—¶ä¸ºå­—ç¬¦ä¸² "N/A"
    total_mv: float                      # æ€»å¸‚å€¼ï¼ˆå•ä½ï¼šå…ƒï¼‰

    # --- è´¢åŠ¡è¿›é˜¶æŒ‡æ ‡ï¼ˆç”± fetchers å¡«å……ï¼Œé»˜è®¤ç¼ºçœï¼‰---
    roe: Union[str, float] = "N/A"       # å‡€èµ„äº§æ”¶ç›Šç‡ï¼ˆ%ï¼‰
    gross_margin: Union[str, float] = "N/A" # æ¯›åˆ©ç‡ï¼ˆ%ï¼‰
    core_business: str = ""              # ä¸»è¥ä¸šåŠ¡æè¿°ï¼ˆV8.11 æ–°å¢å…œåº•é¡¹ï¼‰

    # --- å†å²ç©¿é€å­—æ®µï¼ˆç”± kline æ•°æ®è®¡ç®—åå›å¡«ï¼Œåˆå§‹æœ‰é»˜è®¤å€¼ï¼‰---
    min_price_3y: float = 0.0            # è¿‘ 3 å¹´æœ€ä½ä»·ï¼ˆå‰å¤æƒï¼‰ï¼Œç”¨äºåº•éƒ¨è®¡ç®—
    price_percentile: float = 0.0       # å½“å‰ä»·æ ¼å¤„äºè¿‘ 3 å¹´çš„ç™¾åˆ†ä½ï¼ˆèŒƒå›´ 0.0~100.0ï¼‰
    rise_from_bottom: float = 0.0       # è·è¿‘ 3 å¹´ä½ç‚¹çš„åå¼¹å¹…åº¦ï¼ˆå•ä½ï¼š%ï¼‰

    # --- åˆ¤å®šçŠ¶æ€å­—æ®µï¼ˆç”± risk_auditor æˆ–å¯¹åº” fetcher å¡«å……ï¼‰---
    holder_trend: str = "æ•°æ®ç¼ºå¤±"       # æœ€æ–°è‚¡ä¸œæˆ·æ•°å˜åŒ–è¶‹åŠ¿æè¿°ï¼ˆå¦‚ "å‡å°‘ 5.2% (ä¸»åŠ›å¸ç­¹)"ï¼‰
    eps_forecast: str = "æå–å¤±è´¥"       # é¢„æµ‹/åç®— EPS æè¿°å­—ç¬¦ä¸²


# ===========================================================================
# 1.1.1 CompetitorFinancials â€” ç«å¯¹è´¢æŠ¥æ¨ªè¯„æ¨¡å‹
# ===========================================================================
@dataclass
class CompetitorFinancials:
    """ç›®æ ‡å…¬å¸åŠå…¶åŒæ¿å—ç«äº‰å¯¹æ‰‹çš„æ ¸å¿ƒè´¢æŠ¥æ‘˜è¦"""
    code: str                            # è‚¡ç¥¨ä»£ç 
    name: str                            # è‚¡ç¥¨åç§°
    income_statement_8q: str             # æœ€è¿‘ 8 æœŸåˆ©æ¶¦è¡¨æ‘˜è¦ (è¥æ”¶/å‡€åˆ©æ¶¦ç­‰)
    balance_sheet_8q: str                # èµ„äº§è´Ÿå€ºæ‘˜è¦
    # æ”¯æŒæ›´å¤šå­—æ®µæ‰©å±•ï¼Œå¯é€‰å­˜å…¥
    cash_flow_8q: str = ""               # ç»è¥ç°é‡‘æµå‡€é¢ (å¯é€‰å­˜å…¥)


# ===========================================================================
# 1.2 NewsItem â€” æƒ…æŠ¥é›·è¾¾æ¨¡å‹
# ç”± fetchers/akshare_client.pyã€fetchers/cctv_news.py ç­‰å¡«å……
# LLM/æ­£åˆ™æ‰“åˆ†åå›å¡« score ä¸ llm_reasoning
# ===========================================================================
@dataclass
class NewsItem:
    """å•æ¡æƒ…æŠ¥/æ–°é—»çš„æ ‡å‡†åŒ–æ•°æ®å®¹å™¨ã€‚"""

    # --- å¿…å¡«åŸºç¡€å­—æ®µ ---
    time: str                            # å‘å¸ƒæ—¶é—´/å‘ç”Ÿæ—¶é—´ï¼Œæ ¼å¼ä¸é™ï¼ˆå¦‚ "2025-02-26" æˆ– "ä»Šæ—¥ç›˜é¢"ï¼‰
    title: str                           # èµ„è®¯æ ‡é¢˜æˆ–å†…å®¹ç®€è¿°
    source: str                          # æƒ…æŠ¥æ¥æºï¼Œå¦‚ "é¾™è™æ¦œ"ã€"æ–°é—»è”æ’­"ã€"å…¨çƒå¿«è®¯"

    # --- è¯„åˆ†å­—æ®µï¼ˆåˆå§‹é»˜è®¤å¾…æ‰“åˆ†çŠ¶æ€ï¼‰---
    tags: list[str] = field(default_factory=list)  # å‘½ä¸­çš„è¯åº“æ ‡ç­¾ï¼Œå¦‚ ["ğŸš€ [Type1:é¢ è¦†å¥‡ç‚¹]"]
    score: int = 0                       # å¥‡ç‚¹å…±æŒ¯è¯„åˆ†ï¼š0=åƒåœ¾/é™·é˜±ï¼Œ1=æ™®é€šå…³æ³¨ï¼Œ2=è¶…æ™¯æ°”æ ¸å¿ƒå…±æŒ¯
    llm_reasoning: str = ""             # å¤§æ¨¡å‹ç»™å‡ºçš„åˆ¤åˆ†ç†ç”±ï¼ˆç”¨äºå®¡è®¡å¸ˆé¢æ¿å±•ç¤ºä¸äºŒæ¬¡åˆ¤å®šï¼‰


# ===========================================================================
# 1.3 RiskStatus â€” é£æ§ç†”æ–­æ¨¡å‹
# ç”± core/risk_auditor.py åŸºäº StockInfo è®¡ç®—å¹¶å¡«å……
# ===========================================================================
@dataclass
class RiskStatus:
    """å¯¹å•åªè‚¡ç¥¨æ‰§è¡Œç‰©ç†é£æ§ç†”æ–­åˆ¤å®šåçš„ç»“æœæ±‡æ€»ã€‚"""

    is_safe: bool = True                 # æ•´ä½“æ˜¯å¦å®‰å…¨ï¼šè§¦å‘ä»»ä½•çº¢çº¿å³ç½®ä¸º False
    market_vol_desc: str = ""           # å¤§ç›˜æµåŠ¨æ€§çŠ¶æ€æè¿°ï¼Œå¦‚ "1.52 ä¸‡äº¿ (ç–¯ç‰›)"
    death_turnover_warn: str = "[å®‰å…¨]"  # æ­»äº¡æ¢æ‰‹ç‡è­¦å‘Šæ–‡æ¡ˆï¼ˆè§¦å‘åˆ™å†™å…¥å…·ä½“æ•°å€¼ï¼‰
    extreme_rise_warn: str = ""         # è¿‘ 60 æ—¥æç«¯é€æ”¯è­¦å‘Šæ–‡æ¡ˆï¼ˆæœªè§¦å‘åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰
    st_warning: str = "[é€šè¿‡]"           # è´¢åŠ¡æš´é›·/ST è­¦å‘Šæ–‡æ¡ˆï¼ˆè§¦å‘åˆ™å†™å…¥çº¢è‰²è­¦æŠ¥æ–‡æ¡ˆï¼‰


# ===========================================================================
# 1.4 HyperProsperityEvent â€” è¶…æ™¯æ°”ç°è±¡çº§äº‹ä»¶æ¨¡å‹
# ç”± fetchers/news_flow_fetcher.py ç»“åˆæœ¬åœ° LLM ä»åŒè½¨çƒ­æ¦œä¸­æçº¯ç”Ÿæˆ
# ===========================================================================
@dataclass
class HyperProsperityEvent:
    """è¢«ç¥ç»å¼•æ“è¯†åˆ«ä¸ºå…·æœ‰è¶…æ™¯æ°”å…±æŒ¯æ½œåŠ›çš„ç°è±¡çº§äº‹ä»¶æ‘˜è¦"""
    title: str                           # æ ¸å¿ƒäº‹ä»¶æ ‡é¢˜/æ‘˜è¦
    category: str                        # æ¡†æ¶æ˜ å°„ï¼š[ç§‘æŠ€çªå˜] / [æ”¿ç»å¤§å±€] / [ä¾›éœ€æå€¼]
    resonance: str                       # å…±æŒ¯éªŒè¯ç»“æœï¼š[çœŸÂ·ç°è±¡çº§ç ´åœˆ] / [é€»è¾‘å­•è‚²æœŸ] ç­‰
    k_value: float                       # æµé‡ç—…æ¯’ç³»æ•° K å€¼
    key_signals: list[str] = field(default_factory=list) # æå–çš„å…³é”®ä¿¡æ¯ç´ æ•°ç»„

